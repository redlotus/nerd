<!DOCTYPE html>
<html lang="en">
    <head>
 
        <title>redlotus</title>
        <meta charset="utf-8" />
        <link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.5.0/pure-min.css">
        <link rel="stylesheet" href="http://redlotus.github.io/nerd/theme/css/blog.css">
        <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css">

  <meta name="tags" contents="diy" />
<meta name="tags" contents="beaglebone" />
     </head>
    <body class="body">
        <div class="header">
            <div class="navbar">
                <a href="http://redlotus.github.io/nerd" class="fa fa-home" title="home"></a>
                <a href="http://redlotus.github.io/nerd/pages/about" class="fa fa-user" title="about"></a>
                <a href="http://redlotus.github.io/nerd/pages/docs" class="fa fa-book" title="docs"></a>
                <a href="http://redlotus.github.io/nerd/pages/cv" class="fa fa-file-text-o" title="resume"></a>
                <a href="https://github.com/redlotus" class="fa fa-github" title="github"></a>
                <a href="https://twitter.com/r3d10tu5" class="fa fa-twitter" title="twitter"></a>
            </div>
        </div>
        <div class="index">
<section id="content">
    <div id="content">
        <div class="post">
            <article>
	            <h1>
		            <a href="http://redlotus.github.io/nerd/posts/2015/Jan/ssh_to_bbb_through_usb/" rel="bookmark"
			            title="Permalink to BeagleBoneBlack Hack: SSH thông qua USB"></a>
		            BeagleBoneBlack Hack: SSH thông qua USB
	            </h1>
	            <div class="content"><h2>SSH vào beaglebone thông qua USB</h2>
<h4><em>[Trên beaglebone]</em></h4>
<h5><em>Đầu tiên chúng ta phải load module g_ether (ethernet gadget)</em></h5>
<p>Tự động load khi khởi động:<br />
<code>echo g_ether &gt; /etc/modules-load.d/g_ether.conf</code>  </p>
<p>Hay chỉ load khi nào cần:<br />
<code>modprobe g_ether</code>  </p>
<h5><em>Tạo profile sử dụng với netctl</em></h5>
<p>Tôi đặt tên cho profile là usb0<br />
<code>vim /etc/netctl/usb0</code>  </p>
<p>Sử dụng ip tĩnh  </p>
<blockquote>
<p>Connection=ethernet<br />
Description='Connection via USB'<br />
Interface=usb0<br />
IP=static<br />
Address=('192.168.7.2/30')`  </p>
</blockquote>
<p>Cho profile này tự động chạy mỗi khi khởi động<br />
<code>netctl enable usb0</code>  </p>
<h4><em>[Trên máy host(dùng để kết nối với beaglebone)]</em></h4>
<p>Khi beaglebone đã kết nối với host qua usb thì trên máy host thì khi dùng <code>ip link</code> kiểm tra sẽ thấy xuất hiện thêm một interface. Tạm gọi là enp*.<br />
Chúng ta sẽ dùng interface này để kết nối với beaglebone<br />
Một trong các cách là chúng ta có thể tạo profile và dùng với netctl như trên, hoặc thủ công hơn thì chúng ta thực hiện mọi việc bằng tay thông qua lệnh <code>ip</code><br />
<code>ip link set enp* up</code><br />
Đặt ip tĩnh cho interface, dùng chung dải mạng với beaglebone<br />
<code>ip addr add 192.168.7.1/30 broadcast 192.168.7.255 dev enp*</code>  </p>
<p>Để tránh xung đột ta phải tắt dhcpcd service và networkd đi, sau này trở đi chúng ta có thể dùng dhclient khi nào cần thì sẽ tiện dụng hơn.<br />
<code>systemctl disable dhcpcd.service  
systemctl disable networkd.service</code>  </p>
<p>Kiểm tra kết nối<br />
<code>ping -c 3 192.168.7.1</code>  </p>
<p>[TODO] Thiết lập Kết nối đến internet  </p>
<blockquote>
<p>ip route add default via default_gateway<br />
echo 1 &gt; /proc/sys/net/ipv4/ip_forward<br />
/sbin/iptables -t nat -A POSTROUTING -o eth1 -j MASQUERADE<br />
/sbin/iptables -A FORWARD -i usb0 -o eth1 -j ACCEPT  </p>
</blockquote></div>
	        </article>
	        
	        <div class="meta">
	            <ul>
	                <li>
	                    <strong>Published:</strong> Sat Jan 17 2015
	                </li>
	                <li>
	                    <strong>Written by:</strong> redlotus
	                </li>
	            </ul>
	        </div>
	<!--
	-->
	    </div>
    </div>
</section>
        </div>
        <div class="footer">
            <p class="fa fa-angle-double-right"> Keep it simple, stupid</p>
            <p class="fa fa-angle-double-left"></p>
        </div>
    </body>
</html>